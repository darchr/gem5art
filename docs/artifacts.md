# Artifacts

## Introduction
As discussed before, all unique entities used during gem5 experiments are termed as artifacts.
Examples of artifacts include: gem5 binary, gem5 source code repo, linux kernel source repo,
linux binary, disk image, and packer binary (used to build the disk image).
The goal of this infrastructure is to keep a record of all the artifacts used in a particular experiment and to return
the set of used artifacts when the same experiment needs to be performed in the future. To make this possible, gem5art uses a database to store artifacts. Each artifact is characterized by different attributes, described below:

- command: command used to build this artifact
- typ: type of the artifact e.g. binary, git repo etc.
- name: name of the artifact
- cwd: current working directory, where the command to build the artifact is run
- path: actual path of the location of the artifact
- inputs: a list of the artifacts used to build the current artifact
- documentation: a docstring explaining the purpose of the artifact
- hash: an MD5 hash for a binary artifact/git hash for a git artifact
- time: time of the creation of an artifact
- id: a UUID associated with the artifact
- git: a dictionary containing the origin, current commit and the repo name for a git artifact (will be an empty dictionary for other types of artifacts)

An example of how a user would create a gem5 binary artifact using gem5art is following:

```python
gem5_binary = Artifact.registerArtifact(
    command = 'scons build/X86/gem5.opt',
    typ = 'binary',
    name = 'gem5',
    cwd = 'gem5/',
    path =  'gem5/build/X86/gem5.opt',
    inputs = [gem5_repo,],
    documentation = 'default gem5 x86'
)
```

Attributes like `id`, `time`, `hash` and `git` are not specified by the user, but are generated by gem5art automatically (when the Artifact object is created for the first time).

```md
To do: Move this note to the appropriate location

Note: While creating new artifacts, warning messages showing that certain attributes (except hash and id) of two artifacts don't match (when artifact similarity is checked in the code) might appear. Users should make sure that they understand the reasons of any such warnings.
```

Another goal of gem5art is to enable sharing of artifacts among multiple users, which is achieved through the use of the centralized
database. Basically, whenever a user tries to create a new artifact, the database is searched to find if the same artifact exists there.
If it does, the artifact is downloaded for use. Otherwise, the newly created artifact is uploaded to the database for later use.
The use of database also avoids running identical experiments (by generating an error message if a user tries to execute exact run which
already exists in the database).

## MongoDB

The particular database used in this work is MongoDB.

In case no database exists or a user want their own database, following steps should be taken to create a new database:

  - Create a new directory
  - Run:
```
`docker run -p 27017:27017 -v <absolute path to the created directory>:/data/db --name mongo-<some tag> -d mongo`
```


## Searching the Database

You can do the following in order to list the artifacts present in the database:

```python
#!/usr/bin/env python3

from pymongo import MongoClient

db = MongoClient().artifact_database
for i in db.artifacts.find():print(i)
```

gem5art also provides a few methods to search the database for artifacts of a particular type or name. For example, to find all disk images in a database you can do the following:

```python
import gem5art.artifact.artifact
for i in gem5art.artifact.artifact.getDiskImages():print(i)
```

Other similar methods include: getLinuxBinaries(), getgem5Binaries()

You can use getByName() method to search database for artifacts using the name attribute. For example, to search for gem5 named artifacts:

```python
import gem5art.artifact.artifact
for i in gem5art.artifact.artifact.getByName("gem5"):print(i)
```
